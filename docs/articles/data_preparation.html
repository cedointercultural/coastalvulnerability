<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coastal vulnerability • coastalvulnerability</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Coastal vulnerability">
<meta property="og:description" content="coastalvulnerability">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coastalvulnerability</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cedointercultural/coastalvulnerability" class="external-link">
    <span class="fa fa-lg fa-github"></span>
     
    source code
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Coastal vulnerability</h1>
            
      
      
      <div class="hidden name"><code>data_preparation.Rmd</code></div>

    </div>

    
    
<p>Set environment</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#rebuild and load the package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># restarts and loads</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">coastalvulnerability</span></span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List of packages for session</span></span>
<span><span class="va">.packages</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"import"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install CRAN packages (if not already installed)</span></span>
<span><span class="va">.inst</span> <span class="op">&lt;-</span> <span class="va">.packages</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.packages</span><span class="op">[</span><span class="op">!</span><span class="va">.inst</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">.packages</span><span class="op">[</span><span class="op">!</span><span class="va">.inst</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load packages into session </span></span>
<span><span class="co">#lapply(.packages, require, character.only=TRUE)</span></span>
<span></span>
<span><span class="co">#specifies what functions to import</span></span>
<span><span class="co"># https://cran.r-project.org/web/packages/import/vignettes/import.html</span></span>
<span><span class="fu">import</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/import/man/importfunctions.html" class="external-link">from</a></span><span class="op">(</span><span class="va">dplyr</span>, <span class="va">mutate</span>, <span class="va">distinct</span>, <span class="va">select</span>, <span class="va">group_by</span>, <span class="va">summarise</span>, keep_when <span class="op">=</span> <span class="va">filter</span><span class="op">)</span></span></code></pre></div>
<p>Set data folder</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set data dir</span></span>
<span><span class="va">input.dir</span> <span class="op">&lt;-</span> <span class="st">"~/coastalvulnerability-inputs"</span></span></code></pre></div>
<p>Identify coastal communities</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#coordinates</span></span>
<span><span class="va">crs.proj.utm</span> <span class="op">&lt;-</span> <span class="st">"+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +datum=NAD83"</span></span>
<span><span class="va">crs.proj.wgs</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span></span>
<span><span class="co">#Gulf of California and Yucatan Peninsula states</span></span>
<span><span class="va">ents.selecc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"['Baja California Sur']"</span>, <span class="st">"['Baja California']"</span>, <span class="st">"['Sonora']"</span>, <span class="st">"['Sinaloa']"</span>, <span class="st">"['Nayarit']"</span>, <span class="st">"['Jalisco']"</span>, <span class="st">"['Yucatán']"</span>, <span class="st">"['Campeche']"</span>, <span class="st">"['Quintana Roo']"</span><span class="op">)</span></span>
<span><span class="va">ents.coast.selecc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baja California Sur"</span>, <span class="st">"Baja California"</span>, <span class="st">"Sonora"</span>, <span class="st">"Sinaloa"</span>, <span class="st">"Nayarit"</span>, <span class="st">"Jalisco"</span>, <span class="st">"Yucatán"</span>, <span class="st">"Campeche"</span>, <span class="st">"Quintana Roo"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#all coastal states</span></span>
<span><span class="co">#ents.coast &lt;- c("Baja California Sur", "Baja California", "Sonora", "Sinaloa", "Nayarit", "Jalisco", "Colima", "Michoacán de Ocampo", "Guerrero", "Oaxaca", "Chiapas", "Quintana Roo", "Yucatán", "Campeche", "Tabasco", "Veracruz de Ignacio de la Llave", "Tamaulipas")</span></span>
<span></span>
<span><span class="co">#read county (municipio) shape and subset selected states</span></span>
<span><span class="va">municipios.selecc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>, <span class="st">"/shp_files/georef-mexico-municipality-millesime.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">keep_when</span><span class="op">(</span><span class="va">sta_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ents.selecc</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `georef-mexico-municipality-millesime' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/georef-mexico-municipality-millesime.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 2475 features and 7 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -118.3651 ymin: 14.5321 xmax: -86.71069 ymax: 32.71865</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#read atlantic ocean shp</span></span>
<span><span class="va">atlantic.shp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/atlantic_ocean.shp"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `atlantic_ocean' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/atlantic_ocean.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -97.89029 ymin: -1.961694 xmax: -49.91987 ymax: 40.08133</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#read pacific ocean shp</span></span>
<span><span class="va">pacific.shp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/pacific_ocean.shp"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `pacific_ocean' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/pacific_ocean.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -130 ymin: -10 xmax: -77.02863 ymax: 40.08133</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#read shp Mexico states</span></span>
<span><span class="va">est.mex</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/datos_INEGI_2020/dest2019gw.shp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `dest2019gw' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/datos_INEGI_2020/dest2019gw.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 32 features and 8 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -118.3651 ymin: 14.5321 xmax: -86.71041 ymax: 32.71865</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estados.shp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/ESTADOS.shp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `ESTADOS' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/ESTADOS.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 32 features and 2 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 907821.8 ymin: 319149.1 xmax: 4082997 ymax: 2349615</span></span>
<span><span class="co">## Projected CRS: North_America_Lambert_Conformal_Conic</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#2020 Census data </span></span>
<span><span class="va">inegi.2020</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/datos_INEGI_2020/conjunto_de_datos/conjunto_de_datos_iter_00_cpv2020.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">LONGITUD</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">NOM_ENT</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ents.coast.selecc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_ENT<span class="op">=</span> <span class="va">ENTIDAD</span>, CVE_MUN <span class="op">=</span> <span class="va">MUN</span>, CVE_LOC<span class="op">=</span><span class="va">LOC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: One or more parsing issues, call `problems()` on your data frame for details,</span></span>
<span><span class="co">## e.g.:</span></span>
<span><span class="co">##   dat &lt;- vroom(...)</span></span>
<span><span class="co">##   problems(dat)</span></span></code></pre>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">195662</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">231</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (224): NOM_ENT, NOM_MUN, NOM_LOC, LONGITUD, LATITUD, POBFEM, POBMAS, P_0...</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span>   (7): ENTIDAD, MUN, LOC, ALTITUD, POBTOT, VIVTOT, TVIVHAB</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#extract and save codes for states</span></span>
<span><span class="va">ents.selecc.codes</span> <span class="op">&lt;-</span> <span class="va">estados.shp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">NOM_ENT</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ents.coast.selecc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ents.selecc.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/edos_gcyuc.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#estados.mx &lt;- cbind(est.2019, st_coordinates(st_centroid(est.2019)))</span></span>
<span></span>
<span><span class="co">#select counties in selected states that are coastal</span></span>
<span><span class="co">#pacific </span></span>
<span><span class="va">mun.cost.pac</span> <span class="op">&lt;-</span> <span class="va">municipios.selecc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>pac_distance<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">pacific.shp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">keep_when</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pac_distance</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#atlantic</span></span>
<span><span class="va">mun.cost.atl</span> <span class="op">&lt;-</span> <span class="va">municipios.selecc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>atl_distance<span class="op">=</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">atlantic.shp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">keep_when</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">atl_distance</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#join counties from apcific and atlantic</span></span>
<span><span class="va">mun.cost</span> <span class="op">&lt;-</span> <span class="va">mun.cost.atl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">mun.cost.pac</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#get codes for states and target municipalities</span></span>
<span><span class="va">mun.ent.codes</span> <span class="op">&lt;-</span> <span class="va">mun.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mun_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\["</span>,<span class="st">""</span>,<span class="va">mun_code</span><span class="op">)</span>, </span>
<span>         mun_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\]"</span>,<span class="st">""</span>,<span class="va">mun_cve</span><span class="op">)</span>,</span>
<span>         mun_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\'"</span>,<span class="st">""</span>,<span class="va">mun_cve</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mun_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\["</span>,<span class="st">""</span>,<span class="va">mun_name</span><span class="op">)</span>, </span>
<span>         mun_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\]"</span>,<span class="st">""</span>,<span class="va">mun_nam</span><span class="op">)</span>,</span>
<span>         mun_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\'"</span>,<span class="st">""</span>,<span class="va">mun_nam</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ent_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\["</span>,<span class="st">""</span>,<span class="va">sta_name</span><span class="op">)</span>, </span>
<span>         ent_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\]"</span>,<span class="st">""</span>,<span class="va">ent_nam</span><span class="op">)</span>,</span>
<span>         ent_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\'"</span>,<span class="st">""</span>,<span class="va">ent_nam</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>ent_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\["</span>,<span class="st">""</span>,<span class="va">sta_code</span><span class="op">)</span>, </span>
<span>         ent_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\]"</span>,<span class="st">""</span>,<span class="va">ent_cve</span><span class="op">)</span>,</span>
<span>         ent_cve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\'"</span>,<span class="st">""</span>,<span class="va">ent_cve</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">mun_cve</span>,<span class="va">mun_nam</span>, <span class="va">ent_cve</span>, <span class="va">ent_nam</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mun.ent.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/"</span>,<span class="st">"mun_ent_codes.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">inegi.2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">keep_when</span><span class="op">(</span><span class="va">CVE_MUN</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mun.ent.codes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 0 × 237</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 237 variables: CVE_ENT &lt;chr&gt;, CVE_LOC &lt;chr&gt;, CVE_MUN &lt;chr&gt;, NOM_ENT &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   NOM_MUN &lt;chr&gt;, NOM_LOC &lt;chr&gt;, LONGITUD &lt;chr&gt;, LATITUD &lt;chr&gt;, ALTITUD &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   POBTOT &lt;dbl&gt;, POBFEM &lt;chr&gt;, POBMAS &lt;chr&gt;, P_0A2 &lt;chr&gt;, P_0A2_F &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   P_0A2_M &lt;chr&gt;, P_3YMAS &lt;chr&gt;, P_3YMAS_F &lt;chr&gt;, P_3YMAS_M &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   P_5YMAS &lt;chr&gt;, P_5YMAS_F &lt;chr&gt;, P_5YMAS_M &lt;chr&gt;, P_12YMAS &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   P_12YMAS_F &lt;chr&gt;, P_12YMAS_M &lt;chr&gt;, P_15YMAS &lt;chr&gt;, P_15YMAS_F &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   P_15YMAS_M &lt;chr&gt;, P_18YMAS &lt;chr&gt;, P_18YMAS_F &lt;chr&gt;, P_18YMAS_M &lt;chr&gt;, …</span></span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get community data, output is spatial data layer</span></span>
<span><span class="va">inegi.cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_community_data.html">get_community_data</a></span><span class="op">(</span><span class="va">inegi.2020</span>, <span class="va">crs.proj.utm</span>, <span class="va">crs.proj.wgs</span>, <span class="va">mun.cost</span>, <span class="va">ents.coast.selecc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 218 warnings in `dplyr::mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `across(POBFEM:TAMLOC, as.numeric)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NAs introduced by coercion</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 217 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.shp</span> <span class="op">&lt;-</span> <span class="va">inegi.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">:</span><span class="va">POBMAS</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">inegi.cost.shp</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/shp_files/"</span>,<span class="st">"inegi_comm_cost.shp"</span><span class="op">)</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Deleting layer `inegi_comm_cost' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing layer `inegi_comm_cost' to data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/processed_data/shp_files/inegi_comm_cost.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing 7641 features with 10 fields and geometry type Point.</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.buffer</span> <span class="op">&lt;-</span>  <span class="va">inegi.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_ENT</span><span class="op">:</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span>dist<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">inegi.cost.buffer</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/"</span>,<span class="st">"inegi_comm_buffer.shp"</span><span class="op">)</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Deleting layer `inegi_comm_buffer' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing layer `inegi_comm_buffer' to data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/inegi_comm_buffer.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing 7641 features with 7 fields and geometry type Polygon.</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.buffer.50</span> <span class="op">&lt;-</span>  <span class="va">inegi.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_ENT</span><span class="op">:</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span>dist<span class="op">=</span><span class="fl">50000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">inegi.cost.buffer.50</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/"</span>,<span class="st">"inegi_comm_buffer_50k.shp"</span><span class="op">)</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Deleting layer `inegi_comm_buffer_50k' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing layer `inegi_comm_buffer_50k' to data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/inegi_comm_buffer_50k.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing 7641 features with 7 fields and geometry type Polygon.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.comm</span> <span class="op">&lt;-</span> <span class="va">inegi.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">:</span><span class="va">NOM_LOC</span>, <span class="va">POBTOT</span>, <span class="va">deci_lon</span>, <span class="va">deci_lat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">CVE_ENT</span>, <span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">NOM_ENT</span>, <span class="va">NOM_MUN</span>, <span class="va">NOM_LOC</span>, <span class="va">POBTOT</span>, <span class="va">deci_lon</span>, <span class="va">deci_lat</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#get location codes for target locations</span></span>
<span></span>
<span><span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"outputs"</span>,<span class="st">"inegi_coast_comm.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/"</span>,<span class="st">"inegi_coast_comm.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#save full census data for selected communities</span></span>
<span></span>
<span><span class="va">inegi.cost.pop</span> <span class="op">&lt;-</span> <span class="va">inegi.cost</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inegi.cost.pop</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/"</span>,<span class="st">"inegi_coast_census.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">mun.cost</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"outputs"</span>,<span class="st">"shp_files"</span>,<span class="st">"mun_cost.shp"</span><span class="op">)</span>, delete_layer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in abbreviate_shapefile_names(obj): Field names abbreviated for ESRI</span></span>
<span><span class="co">## Shapefile driver</span></span></code></pre>
<pre><code><span><span class="co">## Deleting layer `mun_cost' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing layer `mun_cost' to data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability/outputs/shp_files/mun_cost.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Writing 93 features with 9 fields and geometry type Multi Polygon.</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#make_map(mun.cost, inegi.cost, estados.shp, crs.proj.utm, thistitle="Total population",thisoutput=here::here("outputs","figures","map_locs_en.png"))</span></span>
<span></span>
<span><span class="co">#make_map(mun.cost, inegi.cost, estados.shp, crs.proj.utm, thistitle="Población total",thisoutput=here::here("outputs","figures","map_locs_sp.png"))</span></span></code></pre></div>
<p>Download DENUE data economic units registered in Mexico by economic
activity <a href="https://en.www.inegi.org.mx/app/mapa/denue/" class="external-link uri">https://en.www.inegi.org.mx/app/mapa/denue/</a> Data updated
November 2023</p>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">25</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (3): economic_activity, link, Yr</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_11_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_21_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_22_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_23_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_31-33_coms_cost.csv"</span></span></code></pre>
<pre><code><span><span class="co">## Warning in data.table::fread(thisdenuefile): Stopped early on line 11. Expected</span></span>
<span><span class="co">## 12 fields but found 13. Consider fill=TRUE and comment.char=. First discarded</span></span>
<span><span class="co">## non-empty line: &lt;&lt;02001,020010001,Industrias manufactureras,ConfecciÃ³n de</span></span>
<span><span class="co">## cortinas, blancs,2,02,Baja</span></span>
<span><span class="co">## California,Ensenada,Ensenada,330652,-116.59513388888888,31.80894388888889&gt;&gt;</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_43_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46111_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46112-46311_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46321-46531_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46591-46911_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_48-49_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_51_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_52_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_53_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_54_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_55_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_56_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_61_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_62_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_71_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_72_1coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_72_2coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_81_1coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_81_2coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_93_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_all_ecactiv.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_fishaqtot_ecactiv.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_fisheries_ecactiv.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_other_ecactiv.csv"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_11_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_21_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_22_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_23_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_31-33_coms_cost.csv"</span></span></code></pre>
<pre><code><span><span class="co">## Warning in data.table::fread(thisdenuefile): Stopped early on line 11. Expected</span></span>
<span><span class="co">## 12 fields but found 13. Consider fill=TRUE and comment.char=. First discarded</span></span>
<span><span class="co">## non-empty line: &lt;&lt;02001,020010001,Industrias manufactureras,ConfecciÃ³n de</span></span>
<span><span class="co">## cortinas, blancs,2,02,Baja</span></span>
<span><span class="co">## California,Ensenada,Ensenada,330652,-116.59513388888888,31.80894388888889&gt;&gt;</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_43_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46111_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46112-46311_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46321-46531_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_46591-46911_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_48-49_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_51_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_52_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_53_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_54_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_55_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_56_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_61_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_62_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_71_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_72_1coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_72_2coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_81_1coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_81_2coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_93_coms_cost.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_all_ecactiv.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_fishaqtot_ecactiv.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/processed_data/denue/denue_other_ecactiv.csv"</span></span></code></pre>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_MUN'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span>
<span><span class="co">## `summarise()` has grouped output by 'CVE_MUN', 'CVE_LOC'. You can override</span></span>
<span><span class="co">## using the `.groups` argument.</span></span>
<span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">821</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">12</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span> <span style="font-weight: bold;">Delimiter:</span> "," <span style="color: #BB0000;">chr</span></span></span>
<span><span class="co">## (8): CVE_LOC, CVE_MUN, actividad, nombre_act, CVE_ENT, NOM_ENT, NOM_MUN,... <span style="color: #00BB00;">dbl</span></span></span>
<span><span class="co">## (4): neg_tot, POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data. <span style="color: #00BBBB;">ℹ</span></span></span>
<span><span class="co">## Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## `summarise()` has grouped output by 'CVE_MUN'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span>
<span><span class="co">## `summarise()` has grouped output by 'CVE_ENT', 'CVE_MUN', 'CVE_LOC'. You can</span></span>
<span><span class="co">## override using the `.groups` argument.</span></span>
<span><span class="co">## `summarise()` has grouped output by 'CVE_ENT', 'CVE_MUN', 'CVE_LOC'. You can</span></span>
<span><span class="co">## override using the `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.locs</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/shp_files/"</span>,<span class="st">"inegi_comm_cost.shp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `inegi_comm_cost' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/processed_data/shp_files/inegi_comm_cost.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 7641 features and 10 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -212445.8 ymin: 2094062 xmax: 3073288 ymax: 3625987</span></span>
<span><span class="co">## Projected CRS: +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">inegi.cost.locs.proj</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.locs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aquifer.avai</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/water_availability/"</span>,<span class="st">"c_acuiferos_09112023.shp"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `c_acuiferos_09112023' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/adaptive_capacity/water_availability/c_acuiferos_09112023.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 653 features and 17 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -117.1257 ymin: 14.53278 xmax: -86.72555 ymax: 32.71872</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aquifer.avai.proj</span> <span class="op">&lt;-</span> <span class="va">aquifer.avai</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cost.aqui</span> <span class="op">&lt;-</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">inegi.cost.locs.proj</span>, <span class="va">aquifer.avai.proj</span>, join<span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_within</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">aqui.table</span> <span class="op">&lt;-</span> <span class="va">cost.aqui</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">OBJECTID</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>aqui_dis <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">DMA_POSITI</span><span class="op">==</span><span class="fl">0</span>, <span class="va">DMA_NEGATI</span>, <span class="va">DMA_POSITI</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">aqui_dis</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">aqui.table</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/water_availability.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road.data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/road_access/"</span>,<span class="st">"GACP_Grado de accesso por carretera_2018.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat.tm</span> <span class="op">&lt;-</span> <span class="va">road.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">tm_centro</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat.pav</span> <span class="op">&lt;-</span> <span class="va">road.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">dis_pav</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat.gr</span> <span class="op">&lt;-</span> <span class="va">road.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">gr_access</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat.dis</span> <span class="op">&lt;-</span> <span class="va">road.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">)</span></span>
<span></span>
<span><span class="va">road.table</span> <span class="op">&lt;-</span> <span class="va">road.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>tm_serv<span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">==</span><span class="st">"Menos de 1 hr."</span>, <span class="fl">0.5</span>,</span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">==</span><span class="st">"1 a 2 hrs."</span>, <span class="fl">1.5</span>,</span>
<span>                                                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">==</span><span class="st">"2 a 3 hrs."</span>, <span class="fl">2.5</span>,</span>
<span>                                                                                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">==</span><span class="st">"más de 4 hrs."</span>, <span class="fl">4.5</span>,</span>
<span>                                                                                                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">tm_centro</span><span class="op">==</span><span class="st">"3 a 4 hrs."</span>, <span class="fl">3.5</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>deg_access<span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">gr_access</span><span class="op">==</span><span class="st">"Muy alto"</span>, <span class="fl">1</span>,</span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">gr_access</span><span class="op">==</span><span class="st">"Alto"</span>, <span class="fl">0.75</span>,</span>
<span>                                                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">gr_access</span><span class="op">==</span><span class="st">"Medio"</span>, <span class="fl">0.5</span>,</span>
<span>                                                                                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">gr_access</span><span class="op">==</span><span class="st">"Bajo"</span>, <span class="fl">0.25</span>,</span>
<span>                                                                                                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">gr_access</span><span class="op">==</span><span class="st">"Muy bajo"</span>, <span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">mutate</span><span class="op">(</span>pav_dis<span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">dis_pav</span><span class="op">==</span><span class="st">"&gt;= 2,000"</span>, <span class="fl">2000</span>,</span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">dis_pav</span><span class="op">==</span><span class="st">"&lt;= 1,000"</span>, <span class="fl">1000</span>,</span>
<span>                                                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">dis_pav</span><span class="op">==</span><span class="st">"&gt; 1,000 y &lt; 2,000"</span>, <span class="fl">1500</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>dis_pub <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">==</span><span class="va">cat.dis</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">10</span>,</span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">==</span><span class="va">cat.dis</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">40</span>,</span>
<span>                                                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">==</span><span class="va">cat.dis</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">120</span>,</span>
<span>                                                                                  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">==</span><span class="va">cat.dis</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">105</span>,</span>
<span>                                                                                                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">disponibilidad</span><span class="op">==</span><span class="va">cat.dis</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">75</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pav_dis</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span>    </span>
<span><span class="va">road.res</span> <span class="op">&lt;-</span> <span class="va">road.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">tm_serv</span>, <span class="va">deg_access</span>, <span class="va">pav_dis</span>, <span class="va">dis_pub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">road.res</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/road_access.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#not used data was from 1985</span></span>
<span><span class="co">#note that OpenStreet Map data can be obtained from R package osmdata and could update this section</span></span>
<span><span class="co">#https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html</span></span>
<span></span>
<span><span class="co"># crs.proj.utm &lt;- "+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +datum=NAD83"</span></span>
<span><span class="co"># crs.proj.wgs &lt;- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ext.carr.proj &lt;- sf::st_read("~/coastalvulnerability-inputs/adaptive_capacity/road_access/carre1mgw.shp") %&gt;% </span></span>
<span><span class="co"># sf::st_transform(., 6367)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># inegi.cost.locs &lt;- sf::st_read(paste0(input.dir,"/processed_data/shp_files/","inegi_comm_cost.shp"))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># inegi.cost.locs.proj &lt;- inegi.cost.locs %&gt;% </span></span>
<span><span class="co">#   sf::st_transform(., 6367)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># length.mt &lt;- ext.carr.proj %&gt;% </span></span>
<span><span class="co">#   sf::st_length() %&gt;% </span></span>
<span><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span><span class="co">#   as.numeric() %&gt;% </span></span>
<span><span class="co">#   tidyr::as_tibble() %&gt;% </span></span>
<span><span class="co">#   dplyr::rename(length_m=value)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ext.carr.proj.dis &lt;- ext.carr.proj %&gt;% </span></span>
<span><span class="co">#   dplyr::bind_cols(length.mt)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #estimate distance to any road</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># inegi.carr.dist &lt;- sf::st_distance(inegi.cost.locs.proj, ext.carr.proj.dis,  by_element = FALSE)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># inegi.carr.dist.m &lt;- inegi.carr.dist %&gt;% </span></span>
<span><span class="co">#  apply(., 1, FUN = min)%&gt;% </span></span>
<span><span class="co">#   tidyr::as_tibble() %&gt;% </span></span>
<span><span class="co">#   mutate(dist_km = value/1000)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># dist.table &lt;- inegi.cost.locs %&gt;% </span></span>
<span><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span><span class="co">#   dplyr::bind_cols(inegi.carr.dist.m) %&gt;% </span></span>
<span><span class="co">#   select(CVE_LOC, CVE_MUN, dist_km)</span></span>
<span><span class="co">#   </span></span>
<span><span class="co">#   </span></span>
<span><span class="co"># #estimate road density within community buffer</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># inegi.cost.buffer.proj &lt;- sf::st_read(paste0(input.dir,"/shp_files/","inegi_comm_buffer.shp")) %&gt;% </span></span>
<span><span class="co"># sf::st_transform(., 6367)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># carretera.loc &lt;- sf::st_intersection(ext.carr.proj.dis, inegi.cost.buffer.proj)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># length.loc &lt;- carretera.loc %&gt;% </span></span>
<span><span class="co">#   sf::st_length() %&gt;% </span></span>
<span><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span><span class="co">#   as.numeric() %&gt;% </span></span>
<span><span class="co">#   tidyr::as_tibble() %&gt;% </span></span>
<span><span class="co">#   dplyr::rename(length_loc=value)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ext.carr.proj.loc &lt;- carretera.loc %&gt;% </span></span>
<span><span class="co">#   dplyr::bind_cols(length.loc)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># carretera.loc.sum &lt;- tidyr::as_tibble(ext.carr.proj.loc) %&gt;% </span></span>
<span><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span><span class="co">#   mutate(CVE_ENT = cve_ent, CVE_MUN = cve_mun, CVE_LOC = cve_loc) %&gt;% </span></span>
<span><span class="co">#   make_code() %&gt;% </span></span>
<span><span class="co">#   group_by(CVE_MUN, CVE_LOC) %&gt;% </span></span>
<span><span class="co">#   summarise(den_loc_km = (sum(length_m)/1000)) %&gt;% </span></span>
<span><span class="co">#   replace(is.na(.), 0) </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># access.res &lt;- dist.table %&gt;% </span></span>
<span><span class="co">#   dplyr::left_join(carretera.loc.sum, by = c("CVELOC", "CVE_MUN"))</span></span></code></pre></div>
<p>Employment centers</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emp.cent</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/employment_centers/cct_2021.xlsx"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">inegi.table</span> <span class="op">&lt;-</span> <span class="st">"inegi_coast_comm.csv"</span></span>
<span><span class="va">inegi.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_inegi.html">fix_inegi</a></span><span class="op">(</span><span class="va">inegi.table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.comm.codes</span>  <span class="op">&lt;-</span>  <span class="va">inegi.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">emp.cent.code</span> <span class="op">&lt;-</span> <span class="va">emp.cent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_ENT<span class="op">=</span> <span class="va">INMUEBLE_CV_ENT</span>, NOM_ENT <span class="op">=</span> <span class="va">INMUEBLE_C_NOM_ENT</span>, CVE_MUN <span class="op">=</span> <span class="va">INMUEBLE_CV_MUN</span>, NOM_MUN<span class="op">=</span> <span class="va">INMUEBLE_C_NOM_MUN</span>, NOM_LOC<span class="op">=</span><span class="va">INMUEBLE_C_NOM_LOC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">NOM_ENT</span><span class="op">!=</span><span class="st">"NA"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">CVE_LOC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_MUN <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">NOM_MUN</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">NOM_LOC</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">emp.cent.code.sum</span> <span class="op">&lt;-</span> <span class="va">emp.cent.code</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>tot_emp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.comms</span>, by<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_emp <span class="op">=</span> <span class="va">tot_emp</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">tot_emp</span>, <span class="va">prop_emp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">emp.cent.code.sum</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/employment_centers.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Infrastructure indicators</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inf.ind</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/access_infrastructure/Base_indicadores_loc_PATP_abril_2023.xlsx"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">inegi.table</span> <span class="op">&lt;-</span> <span class="st">"inegi_coast_comm.csv"</span></span>
<span><span class="va">inegi.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_inegi.html">fix_inegi</a></span><span class="op">(</span><span class="va">inegi.table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.comm.codes</span>  <span class="op">&lt;-</span>  <span class="va">inegi.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inf.ind.codes</span> <span class="op">&lt;-</span> <span class="va">inf.ind</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CVE_MUN <span class="op">=</span> <span class="va">`Clave municipio`</span>, CVE_LOC <span class="op">=</span> <span class="va">`Clave localidad`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">r_1erN_auto</span>, <span class="va">r_2doN_auto</span>, <span class="va">r_3erN_auto</span>, <span class="va">r_preescolar_auto</span>, <span class="va">r_primaria_auto</span>, <span class="va">r_secundaria_auto</span>, <span class="va">r_CID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>acc_1health<span class="op">=</span><span class="va">r_1erN_auto</span>, acc_2health<span class="op">=</span><span class="va">r_2doN_auto</span>, acc_3health<span class="op">=</span><span class="va">r_3erN_auto</span>, acc_presc<span class="op">=</span><span class="va">r_preescolar_auto</span>, acc_elem<span class="op">=</span><span class="va">r_primaria_auto</span>, acc_sec <span class="op">=</span> <span class="va">r_secundaria_auto</span>, acc_dev<span class="op">=</span><span class="va">r_CID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">names.categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">inf.ind.codes</span><span class="op">)</span></span>
<span><span class="va">num.cols</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names.categ</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new.tibble</span> <span class="op">&lt;-</span> <span class="va">inf.ind.codes</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">new.inf.codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">num.cols</span>, <span class="va">add_varcategory</span>, <span class="va">names.categ</span>, <span class="va">inf.ind.codes</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#NAs correspond to not available values in the original table. These are mostly islands, where the corresponding centers are too far but distance was not measured, so we assigned the highest values</span></span>
<span></span>
<span><span class="va">inf.table</span> <span class="op">&lt;-</span> <span class="va">new.inf.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">new.tibble</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">CVE_LOC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">inf.table.max</span> <span class="op">&lt;-</span> <span class="va">inf.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>acc_1healthMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_1health</span><span class="op">)</span>, acc_2healthMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_2health</span><span class="op">)</span>, acc_3healthMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_3health</span><span class="op">)</span>, acc_prescMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_presc</span><span class="op">)</span>, acc_elemMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_elem</span><span class="op">)</span>,</span>
<span>                   acc_secMax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_sec</span><span class="op">)</span>, acc_devMax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">acc_dev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inf.table.rev</span> <span class="op">&lt;-</span> <span class="va">inf.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>acc_1health <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_1health</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_1healthMax</span>, <span class="va">acc_1health</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>acc_2health <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_2health</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_2healthMax</span>, <span class="va">acc_2health</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>acc_3health <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_3health</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_3healthMax</span>, <span class="va">acc_3health</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>acc_presc <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_presc</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_prescMax</span>, <span class="va">acc_presc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">mutate</span><span class="op">(</span>acc_elem <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_elem</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_elemMax</span>, <span class="va">acc_elem</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">mutate</span><span class="op">(</span>acc_sec <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_sec</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_secMax</span>, <span class="va">acc_sec</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">mutate</span><span class="op">(</span>acc_dev <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">acc_dev</span><span class="op">==</span><span class="fl">0</span>, <span class="va">inf.table.max</span><span class="op">$</span><span class="va">acc_devMax</span>, <span class="va">acc_dev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">inf.table.rev</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/access_infrastructure.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Poverty indicators and marginalization index</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.table</span> <span class="op">&lt;-</span> <span class="st">"inegi_coast_comm.csv"</span></span>
<span><span class="va">inegi.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_inegi.html">fix_inegi</a></span><span class="op">(</span><span class="va">inegi.table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.comm.codes</span>  <span class="op">&lt;-</span>  <span class="va">inegi.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pov.ind.1</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xls</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/poverty_marginalization/IML_2020.xls"</span>, sheet <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pov.ind.comms.1</span> <span class="op">&lt;-</span> <span class="va">pov.ind.1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">CVE_LOC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pov.ind.2</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xls</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/poverty_marginalization/IML_2020.xls"</span>, sheet <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pov.ind.comms.2</span> <span class="op">&lt;-</span> <span class="va">pov.ind.2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">CVE_LOC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pov.code</span> <span class="op">&lt;-</span> <span class="va">pov.ind.comms.1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">pov.ind.comms.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_ENT<span class="op">=</span> <span class="va">ENT</span>, CVE_MUN <span class="op">=</span> <span class="va">MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">pov.table</span> <span class="op">&lt;-</span> <span class="va">pov.code</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">ANALF</span><span class="op">:</span><span class="va">IM_2020</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Social gap index</span></span>
<span></span>
<span><span class="va">social.ind.1</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/poverty_marginalization/IRS_localidades_2020.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...17`</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">social.ind.2</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/poverty_marginalization/IRS_localidades_2020.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...17`</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soc.ind.comms.1</span> <span class="op">&lt;-</span> <span class="va">social.ind.1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">cve_loc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC <span class="op">=</span> <span class="va">cve_loc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soc.ind.comms.2</span> <span class="op">&lt;-</span> <span class="va">social.ind.2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">cve_loc</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">inegi.comm.codes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC <span class="op">=</span> <span class="va">cve_loc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">soc.code</span> <span class="op">&lt;-</span> <span class="va">soc.ind.comms.1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">soc.ind.comms.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">9</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (2): CVE_ENT, NOM_ENT</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soc.table</span> <span class="op">&lt;-</span> <span class="va">soc.code</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">social_indx</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pov.res</span> <span class="op">&lt;-</span> <span class="va">soc.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pov.table</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">pov.res</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/poverty_indices.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Fisheries subsidies</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.table</span> <span class="op">&lt;-</span> <span class="st">"inegi_coast_comm.csv"</span></span>
<span><span class="va">inegi.cost.comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_inegi.html">fix_inegi</a></span><span class="op">(</span><span class="va">inegi.table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost.codes.ent</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">CVE_ENT</span>, <span class="va">NOM_ENT</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">cost.codes.mun</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">CVE_ENT</span>, <span class="va">NOM_MUN</span>, <span class="va">CVE_MUN</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">cost.codes.loc</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu">distinct</span><span class="op">(</span><span class="va">NOM_ENT</span>, <span class="va">CVE_ENT</span>, <span class="va">NOM_MUN</span>, <span class="va">CVE_MUN</span>, <span class="va">NOM_LOC</span>, <span class="va">CVE_LOC</span><span class="op">)</span> </span>
<span> </span>
<span><span class="co">#googlesheet to keep track of names that need correction</span></span>
<span><span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_deauth.html" class="external-link">gs4_deauth</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">locs.pesca</span> <span class="op">&lt;-</span> <span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="st">"1eJXjwlHqEzSAZaTmE_XyN93fu6EI0I8igRH4AdvXOl8"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Reading from <span style="color: #00BBBB;">vulnerability_tables</span>.</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Range <span style="color: #BBBB00;">locs</span>.</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correct.ent</span> <span class="op">&lt;-</span> <span class="va">locs.pesca</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_LOC_REV</span><span class="op">)</span></span>
<span></span>
<span><span class="va">correct.loc</span> <span class="op">&lt;-</span> <span class="va">locs.pesca</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_ENT_REV</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NOM_LOC_REV</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#gas subsidies</span></span>
<span><span class="va">gas.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/padron_beneficiarios_combustible_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>localidad<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="st">" "</span>,<span class="va">localidad</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_MUN <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">municipio</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_MUN <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">municipio</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">localidad</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">tipo_cobertura</span><span class="op">==</span><span class="st">"LOCALIDAD"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BAHIA TORTUGAS"</span>, <span class="va">unidadeconmica</span><span class="op">)</span>, <span class="st">"BAHIA TORTUGAS"</span>, </span>
<span>                                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"SCPP EMANCIPACION SC DE RL"</span>, <span class="va">unidadeconmica</span><span class="op">)</span>, <span class="st">"BAHIA TORTUGAS"</span>, <span class="va">NOM_LOC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas.subsidy.comms</span> <span class="op">&lt;-</span>  <span class="va">gas.subsidy</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">correct.ent</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_LOC"</span>,<span class="st">"NOM_ENT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_ENT <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NOM_ENT_REV</span><span class="op">)</span>, <span class="va">NOM_ENT_REV</span>, <span class="va">NOM_ENT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ent_old <span class="op">=</span> <span class="va">entidad</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">correct.loc</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_LOC"</span>,<span class="st">"NOM_ENT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NOM_LOC_REV</span><span class="op">)</span>, <span class="va">NOM_LOC_REV</span>, <span class="va">NOM_LOC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>mun_old <span class="op">=</span> <span class="va">municipio</span>, loc_old <span class="op">=</span> <span class="va">localidad</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">NOM_LOC</span>, <span class="va">NOM_ENT</span>, <span class="va">beneficiario</span>, <span class="va">monto_conapesca</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">monto_conapesca</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#some states, municipalites and locations are wrong so starting from ENT</span></span>
<span><span class="va">gas.subsidy.ent</span> <span class="op">&lt;-</span> <span class="va">gas.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cost.codes.ent</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_ENT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_ENT</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gas.subsidy.loc</span> <span class="op">&lt;-</span> <span class="va">gas.subsidy.ent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_ENT"</span>,<span class="st">"NOM_LOC"</span>,<span class="st">"NOM_ENT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">CVE_ENT</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gas.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">gas.subsidy.loc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_bengas<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_bengas<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">monto_conapesca</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>bengas_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_bengas</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_bengas</span>, <span class="va">bengas_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#BIENPESCA</span></span>
<span></span>
<span><span class="va">bienpesca.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/bien_pescadores_y_acuicultores_2020.xlsx"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/bienpesca_2021.xlsx"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/bienpesca_2022.xlsx"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/bienpesca_2023.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bpesca.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bienpesca.files</span>, <span class="va">clean_bienpesca</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bpesca.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">bpesca.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_MUN</span>, <span class="op">-</span><span class="va">CVE_MUN</span>, <span class="op">-</span><span class="va">cve_mun</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_ENT"</span>,<span class="st">"CVE_ENT"</span>,<span class="st">"NOM_LOC"</span>,<span class="st">"CVE_LOC"</span>,<span class="st">"POBTOT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bpesca.subsidy.res</span> <span class="op">&lt;-</span> <span class="va">bpesca.subsidy.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_bpesca<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_bpesca<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>bpesca_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_bpesca</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_bpesca</span>, <span class="va">bpesca_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to aquaculture to purchase seed</span></span>
<span><span class="va">seed.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/semilla_acuicola_2021.xlsx"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/semilla_acuicola_2022.xlsx"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/semilla_acuicola_2023.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seed.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">seed.files</span>, <span class="va">clean_seedfiles</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seed.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">seed.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed.subsidy.res</span> <span class="op">&lt;-</span> <span class="va">seed.subsidy.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_seed<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_seed<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`MONTO FEDERAL`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>seed_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_seed</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_seed</span>, <span class="va">seed_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to fund genetic line improvements</span></span>
<span><span class="va">gen.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/recursos_geneticos_acuicolas_2020.xlsx"</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/lineas_geneticas_mejoradas_2021.xlsx"</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/lineas_geneticas_mejoradas_2022.xlsx"</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/lineas_geneticas_mejoradas_2023.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gen.files</span>, <span class="va">clean_seedfiles</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">gen.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen.subsidy.res</span> <span class="op">&lt;-</span> <span class="va">gen.subsidy.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_gen<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_gen<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`MONTO FEDERAL`</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>gen_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_gen</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_gen</span>, <span class="va">gen_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#vessel modernization</span></span>
<span></span>
<span><span class="va">boat.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_modernizacion_barcos_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boat.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">boat.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boat.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">boat.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">tipo_cobertura</span><span class="op">==</span><span class="st">"LOCAL"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">cve_loc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, monto_gob_edo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">monto_gob_edo</span><span class="op">)</span>, monto_productor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">monto_productor</span><span class="op">)</span>, mont_tot <span class="op">=</span> <span class="op">(</span><span class="va">monto_productor</span> <span class="op">+</span> <span class="va">monto_gob_edo</span> <span class="op">+</span> <span class="va">monto_conapesca</span><span class="op">)</span> <span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_ENT"</span>,<span class="st">"NOM_LOC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">boat.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">boat.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_boat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_boat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>boat_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_boat</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_boat</span>, <span class="va">boat_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies for product commercialization</span></span>
<span><span class="va">commerce.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_comercializacion_2014-2019.xlsx"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `pesqueria` -&gt; `pesqueria...23`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `pesqueria` -&gt; `pesqueria...27`</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">commerce.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">commerce.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">commerce.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">commerce.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">tipo_cobertura</span><span class="op">==</span><span class="st">"LOCAL"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mont_tot <span class="op">=</span> <span class="op">(</span><span class="va">monto_gob_edo</span> <span class="op">+</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="va">commerce.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">commerce.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_comm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">no_beneficiarios</span><span class="op">)</span>, tot_comm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>comm_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_comm</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_comm</span>, <span class="va">comm_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies for aquaculture</span></span>
<span><span class="va">aqua.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_acuacultura_2014-2019.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#this file does not have project characteristics for 2019 data, that is in aquaculture_incentives_2019.xlsx</span></span>
<span></span>
<span><span class="va">aqua.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">aqua.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aqua.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">aqua.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">tipo_cobertura</span><span class="op">==</span><span class="st">"LOCAL"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aqua.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">aqua.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_aqua<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_aqua<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>aqua_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_aqua</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_aqua</span>, <span class="va">aqua_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to support seafood consumption</span></span>
<span><span class="va">consump.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_consumo_2014-2019.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">consump.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">consump.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consump.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">consump.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">consump.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">consump.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_cons<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_cons<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cons_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_cons</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_cons</span>, <span class="va">cons_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to support fishery value chains</span></span>
<span><span class="va">value.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_cadenas_productivas_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span></span>
<span></span>
<span><span class="va">value.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">value.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">value.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">value.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">value.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_value</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_value</span>, <span class="va">value_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to strengthen fisheries</span></span>
<span><span class="va">str.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_fortalecimiento_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span></span>
<span></span>
<span><span class="va">str.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">str.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">str.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">str.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">str.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">str.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_str<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_str<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>str_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_str</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_str</span>, <span class="va">str_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to strengthen inspection and surveillance</span></span>
<span><span class="va">ins.subsidy</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_vigilancia_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>localidad <span class="op">=</span> <span class="va">localidad_ue</span>, municipio <span class="op">=</span> <span class="va">municipio_ue</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ins.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">ins.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ins.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">ins.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_MUN <span class="op">=</span> <span class="va">cve_mun_ue</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent_ue</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ins.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">ins.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_ins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_ins<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ins_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_ins</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_ins</span>, <span class="va">ins_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to strengthen the legal framework</span></span>
<span><span class="va">leg.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_ordenamiento_2011-2019.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">leg.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">leg.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leg.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">leg.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span> CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">correct.loc</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOM_LOC"</span>,<span class="st">"NOM_ENT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NOM_LOC_REV</span><span class="op">)</span>, <span class="va">NOM_LOC_REV</span>, <span class="va">NOM_LOC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">leg.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">leg.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_leg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_leg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>leg_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_leg</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_leg</span>, <span class="va">leg_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subsidies to reduce effort in industrial fishing</span></span>
<span><span class="va">eff.subsidy</span><span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/adaptive_capacity/fishery_subsidies/beneficiarios_reduccion_esfuerzo_2011-2018.xlsx"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">año</span><span class="op">&gt;=</span><span class="fl">2014</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eff.subsidy.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="va">eff.subsidy</span>, <span class="va">inegi.cost.comm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eff.subsidy.table</span> <span class="op">&lt;-</span> <span class="va">eff.subsidy.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id_row <span class="op">=</span> <span class="fl">1</span>, mont_tot <span class="op">=</span> <span class="va">monto_conapesca</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_LOC<span class="op">=</span><span class="va">cve_loc</span>, CVE_MUN <span class="op">=</span> <span class="va">cve_mun</span>, CVE_ENT<span class="op">=</span><span class="va">cve_ent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">mont_tot</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eff.subsidy.codes</span> <span class="op">&lt;-</span> <span class="va">eff.subsidy.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>no_eff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">id_row</span><span class="op">)</span>, tot_eff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mont_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.comm</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>eff_perc <span class="op">=</span> <span class="op">(</span><span class="va">tot_eff</span> <span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">no_eff</span>, <span class="va">eff_perc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_LOC'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all.fishery.subsidies</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bpesca.subsidy.res</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">seed.subsidy.res</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gas.subsidy.codes</span>,by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">boat.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">commerce.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">aqua.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">consump.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">value.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">str.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ins.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">leg.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">eff.subsidy.codes</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gen.subsidy.res</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>, <span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fishery.tot.subs</span> <span class="op">&lt;-</span> <span class="va">all.fishery.subsidies</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">fishery.comm.subs</span> <span class="op">&lt;-</span> <span class="va">fishery.tot.subs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">no_bpesca</span><span class="op">:</span><span class="va">gen_perc</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="va">sum</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#fishery.tot.subs %&gt;% summarise(across(no_bpesca:gen_perc, sum)) #use to test that all columns have value</span></span>
<span></span>
<span><span class="va">fishery.tot.subs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">distinct</span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 7,641 × 1</span></span></span>
<span><span class="co">##    CVE_LOC  </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 020010001</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 020010035</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 020010059</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 020010083</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 020010095</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 020010114</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 020010118</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 020010121</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 020010123</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 020010124</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 7,631 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">fishery.tot.subs</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/"</span>,<span class="st">"fisheries_subsidies.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Extract permit information from the Registro Nacional de Pesca y
Acuacultura RNPA <a href="https://www.gob.mx/conapesca/documentos/registro-nacional-de-pesca-y-acuacultura-rnpa" class="external-link uri">https://www.gob.mx/conapesca/documentos/registro-nacional-de-pesca-y-acuacultura-rnpa</a></p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#googlesheet to keep track of names that need correction</span></span>
<span><span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_deauth.html" class="external-link">gs4_deauth</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">locs.pesca</span> <span class="op">&lt;-</span> <span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="st">"1eJXjwlHqEzSAZaTmE_XyN93fu6EI0I8igRH4AdvXOl8"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Reading from <span style="color: #00BBBB;">vulnerability_tables</span>.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Range <span style="color: #BBBB00;">locs</span>.</span></span></code></pre>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ents.coast.selecc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baja California Sur"</span>, <span class="st">"Baja California"</span>, <span class="st">"Sonora"</span>, <span class="st">"Sinaloa"</span>, <span class="st">"Nayarit"</span>, <span class="st">"Jalisco"</span>, <span class="st">"Yucatán"</span>, <span class="st">"Campeche"</span>, <span class="st">"Quintana Roo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">coast.selecc</span> <span class="op">&lt;-</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">ents.coast.selecc</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#only communities considered in the analysis</span></span>
<span><span class="va">inegi.cost.comm</span>  <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/"</span>,<span class="st">"inegi_coast_comm.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_ENT<span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">NOM_ENT</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span>, NOM_ENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">NOM_ENT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_MUN <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">NOM_MUN</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span>, NOM_MUN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">NOM_MUN</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>NOM_LOC <span class="op">=</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trans_general.html" class="external-link">stri_trans_general</a></span><span class="op">(</span>str <span class="op">=</span> <span class="va">NOM_LOC</span>, id <span class="op">=</span> <span class="st">"Latin-ASCII"</span><span class="op">)</span>, NOM_LOC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">NOM_LOC</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.mun</span> <span class="op">&lt;-</span> <span class="va">inegi.cost.comm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">NOM_MUN</span>, <span class="va">CVE_MUN</span><span class="op">)</span></span>
<span></span>
<span><span class="va">permit.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/sensitivity/permit_data"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">no.permitfiles</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">permit.files</span><span class="op">)</span></span>
<span></span>
<span><span class="va">permit.data.inegi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">no.permitfiles</span>, <span class="va">extract_permits</span>, <span class="va">permit.files</span>, <span class="va">inegi.cost.comm</span>, <span class="va">coast.selecc</span>, <span class="va">locs.pesca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/ANEXO_08197000319_PERMISOS PESCA_Pacifico.xlsx"</span></span>
<span><span class="co">##  [1] "REG."                                  </span></span>
<span><span class="co">##  [2] "ENTIDAD"                               </span></span>
<span><span class="co">##  [3] "NOMBRE DEL PERMISIONARIO O COOPERATIVA"</span></span>
<span><span class="co">##  [4] "TIPO DE TRAMITE"                       </span></span>
<span><span class="co">##  [5] "CLAVE DE RNP"                          </span></span>
<span><span class="co">##  [6] "NO. DE PERMISO"                        </span></span>
<span><span class="co">##  [7] "ESPECIE"                               </span></span>
<span><span class="co">##  [8] "NOMBRE DE LA EMBARCACION"              </span></span>
<span><span class="co">##  [9] "ZONA DE PESCA"                         </span></span>
<span><span class="co">## [10] "FECHA DE EXPEDICIÓN"                   </span></span>
<span><span class="co">## [11] "FECHA DE TERMINO"                      </span></span>
<span><span class="co">## [12] "LOCALIDAD"                             </span></span>
<span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/ANEXO_1000036_UE_GOM.xlsx"</span></span>
<span><span class="co">## [1] "NO."              "RNPA"             "UNIDAD ECONÓMICA" "ESTADO"          </span></span>
<span><span class="co">## [5] "MUNICIPIO"        "LOCALIDAD"        "INICIO OPER."     "ULTOMA MOD."     </span></span>
<span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/ANEXO_1000037_UNIDADES_ECONOMICAS.xlsx"</span></span>
<span><span class="co">## [1] "NO."              "RNPA"             "UNIDAD ECONÓMICA" "ESTADO"          </span></span>
<span><span class="co">## [5] "MUNICIPIO"        "LOCALIDAD"        "INICIO OPER."     "ULTOMA MOD."     </span></span>
<span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/permisos_pesca_comercial_2015-2023.xlsx"</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting date in P11155 / R11155C16: got '0009/01/25'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting date in P11830 / R11830C16: got '*'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D17435 / R17435C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D17526 / R17526C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D17528 / R17528C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D18422 / R18422C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D18820 / R18820C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D19197 / R19197C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D19334 / R19334C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D19355 / R19355C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D19382 / R19382C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D19821 / R19821C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D20340 / R20340C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D26620 / R26620C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D27869 / R27869C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D28643 / R28643C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D29753 / R29753C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D30961 / R30961C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D32992 / R32992C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D35392 / R35392C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D35905 / R35905C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D37898 / R37898C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D38089 / R38089C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D38254 / R38254C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D38375 / R38375C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D38687 / R38687C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Expecting numeric in D38743 / R38743C4: got '**'</span></span></code></pre>
<pre><code><span><span class="co">##  [1] "TIPO_EMBARCACION"                     </span></span>
<span><span class="co">##  [2] "ID_ESTADO"                            </span></span>
<span><span class="co">##  [3] "ESTADO"                               </span></span>
<span><span class="co">##  [4] "ID_MUNICIPIO"                         </span></span>
<span><span class="co">##  [5] "MUNICIPIO"                            </span></span>
<span><span class="co">##  [6] "ID_LOCALIDAD"                         </span></span>
<span><span class="co">##  [7] "LOCALIDAD"                            </span></span>
<span><span class="co">##  [8] "RNP_TITULAR"                          </span></span>
<span><span class="co">##  [9] "RAZON_SOCIAL"                         </span></span>
<span><span class="co">## [10] "ZONA_DE_OPERACION"                    </span></span>
<span><span class="co">## [11] "PUERTO_BASE"                          </span></span>
<span><span class="co">## [12] "EMBARCACION_O_NUMERO_DE_EMBARCACIONES"</span></span>
<span><span class="co">## [13] "PESQUERIA"                            </span></span>
<span><span class="co">## [14] "PERMISO"                              </span></span>
<span><span class="co">## [15] "FECHA_INICIO"                         </span></span>
<span><span class="co">## [16] "FECHA_TERMINO"                        </span></span>
<span><span class="co">## [17] "ARTES_DE_PESCA"                       </span></span>
<span><span class="co">## [18] "DESCRIPCION_ARTES_DE_PESCA"           </span></span>
<span><span class="co">## [19] "OBSERVACIONES"                        </span></span>
<span><span class="co">## [20] "SUBSERIE"                             </span></span>
<span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/reporte_embarcaciones_menores_29_02_2024_JC.xlsx"</span></span>
<span><span class="co">##  [1] "#"               "TIPO"            "CLAVE ESTADO"    "NOMBRE ESTADO"  </span></span>
<span><span class="co">##  [5] "CLAVE OFICINA"   "NOMBRE OFICINA"  "FECHA REGISTRO"  "RNPA ACTIVO"    </span></span>
<span><span class="co">##  [9] "NOMBRE ACTIVO"   "MATRÍCULA"       "MEDIDA ESLORA"   "CAPACIDAD CARGA"</span></span>
<span><span class="co">## [1] "file /home/atlantis/coastalvulnerability-inputs/sensitivity/permit_data/reporte_unidades_economicas 08-12-2023 - JC.xlsx"</span></span>
<span><span class="co">## [1] "#"                "TIPO"             "CLAVE ESTADO"     "NOMBRE ESTADO"   </span></span>
<span><span class="co">## [5] "CLAVE OFICINA"    "NOMBRE OFICINA"   "RNPA"             "UNIDAD ECONÓMICA"</span></span></code></pre>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to check location names</span></span>
<span><span class="co"># permit.table &lt;- permit.data.inegi %&gt;% </span></span>
<span><span class="co">#   dplyr::bind_rows() %&gt;% </span></span>
<span><span class="co">#   keep_when(!is.na(NOM_LOC)) %&gt;% </span></span>
<span><span class="co">#   keep_when(is.na(CVE_MUN)) %&gt;% distinct(NOM_ENT, NOM_MUN, NOM_LOC, CVE_MUN, CVE_LOC)</span></span>
<span> </span>
<span><span class="va">permit.table</span> <span class="op">&lt;-</span> <span class="va">permit.data.inegi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">NOM_ENT</span>, <span class="va">rnp_code</span>, <span class="va">NOM_MUN</span>, <span class="va">NOM_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>,  <span class="va">deci_lat</span>, <span class="va">deci_lon</span>, <span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.mun</span>, by <span class="op">=</span> <span class="st">"CVE_MUN"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">permit.per.loc</span> <span class="op">&lt;-</span> <span class="va">permit.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>index_no <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">NOM_ENT</span>, <span class="va">NOM_MUN</span>, <span class="va">NOM_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">deci_lat</span>, <span class="va">deci_lon</span>, <span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>tot_perm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_no</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>perm_pcapita <span class="op">=</span> <span class="va">tot_perm</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">tot_perm</span>, <span class="va">perm_pcapita</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'NOM_ENT', 'NOM_MUN', 'NOM_LOC', 'CVE_MUN',</span></span>
<span><span class="co">## 'CVE_LOC', 'deci_lat', 'deci_lon'. You can override using the `.groups`</span></span>
<span><span class="co">## argument.</span></span></code></pre>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">permit.per.loc</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/sensitivity/fishery_permits.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">catch.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/catch"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">no.catchfiles</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">catch.files</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#match to rnpa number</span></span>
<span></span>
<span><span class="va">catch.rnpa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">no.catchfiles</span>,<span class="va">get_rnpa_catch</span>, <span class="va">catch.files</span>, <span class="va">coast.selecc</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/catch/AVISOS_ MAYORES_MENORES_COSECHA_2018.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/catch/AVISOS_ MAYORES_MENORES_COSECHA_2019.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/catch/AVISOS_ MAYORES_MENORES_COSECHA_2020.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/catch/AVISOS_ MAYORES_MENORES_COSECHA_2021.csv"</span></span>
<span><span class="co">## [1] "/home/atlantis/coastalvulnerability-inputs/catch/AVISOS_ MAYORES_MENORES_COSECHA_2022.csv"</span></span></code></pre>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnpa.catch.table</span> <span class="op">&lt;-</span> <span class="va">catch.rnpa</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rnp_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rnp_code</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">catch.rnpa.codes</span> <span class="op">&lt;-</span> <span class="va">rnpa.catch.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">rnp_code</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">catch.permit.table</span> <span class="op">&lt;-</span> <span class="va">catch.rnpa.codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">permit.table</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rnp_code"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">catch.loc</span> <span class="op">&lt;-</span> <span class="va">catch.permit.table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">rnpa.catch.table</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rnp_code"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">NOM_MUN</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inegi.cost.mun</span>, by <span class="op">=</span> <span class="st">"CVE_MUN"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>tot_catch_mt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tot_weight_kg</span><span class="op">)</span><span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>catch_percapita <span class="op">=</span> <span class="va">tot_catch_mt</span><span class="op">/</span> <span class="va">POBTOT</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Warning in dplyr::left_join(., rnpa.catch.table, by = c("rnp_code")): Detected an unexpected many-to-many relationship between `x` and `y`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Row 1 of `x` matches multiple rows in `y`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Row 19550 of `y` matches multiple rows in `x`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> If a many-to-many relationship is expected, set `relationship =</span></span>
<span><span class="co">##   "many-to-many"` to silence this warning.</span></span></code></pre>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_MUN', 'CVE_LOC'. You can override</span></span>
<span><span class="co">## using the `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">catch.loc</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/sensitivity/fishery_catch.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Assign catch to locations</p>
<p>Natural protected areas</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crs.proj.utm</span> <span class="op">&lt;-</span> <span class="st">"+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +datum=NAD83"</span></span>
<span><span class="va">crs.proj.wgs</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span></span>
<span><span class="va">prot.area</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"~/coastalvulnerability-inputs/adaptive_capacity/natural_protected_areas/226_ANP_ITRF08_27022024.shp"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `226_ANP_ITRF08_27022024' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/adaptive_capacity/natural_protected_areas/226_ANP_ITRF08_27022024.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 226 features and 13 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -118.6344 ymin: 11.9686 xmax: -85.39723 ymax: 32.48333</span></span>
<span><span class="co">## Geodetic CRS:  GCS_MEXICO_ITRF_2008</span></span></code></pre>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#estimate road access within community buffer</span></span>
<span></span>
<span><span class="va">inegi.cost.buffer.proj</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/"</span>,<span class="st">"inegi_comm_buffer_50k.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `inegi_comm_buffer_50k' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/inegi_comm_buffer_50k.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 7641 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -262445.8 ymin: 2044062 xmax: 3123288 ymax: 3675987</span></span>
<span><span class="co">## Projected CRS: +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs</span></span></code></pre>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prot.area.buff</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">prot.area</span>, <span class="va">inegi.cost.buffer.proj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">area.int</span> <span class="op">&lt;-</span> <span class="va">prot.area.buff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>area_loc_m2<span class="op">=</span><span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ext.area.proj.loc</span> <span class="op">&lt;-</span> <span class="va">prot.area.buff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">area.int</span><span class="op">)</span></span>
<span></span>
<span><span class="va">area.loc.sum</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">ext.area.proj.loc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>anp_area_loc_kmsq <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">area_loc_m2</span><span class="op">)</span><span class="op">/</span><span class="fl">1e+6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_MUN'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">area.loc.sum</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/natural_protected_area_buffer.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Aquaculture facilities</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.cost.buffer.proj</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/shp_files/"</span>,<span class="st">"inegi_comm_buffer.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `inegi_comm_buffer' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/shp_files/inegi_comm_buffer.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 7641 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -222445.8 ymin: 2084062 xmax: 3083288 ymax: 3635987</span></span>
<span><span class="co">## Projected CRS: +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs</span></span></code></pre>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aquaculture.units</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/sensitivity/aquaculture_polygons/"</span>,<span class="st">"aquaculture_polygons_2023.shp"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `aquaculture_polygons_2023' from data source </span></span>
<span><span class="co">##   `/home/atlantis/coastalvulnerability-inputs/sensitivity/aquaculture_polygons/aquaculture_polygons_2023.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 2565 features and 12 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XYZ</span></span>
<span><span class="co">## Bounding box:  xmin: -117.2367 ymin: 2.905654 xmax: -84.49158 ymax: 32.40414</span></span>
<span><span class="co">## z_range:       zmin: 0 zmax: 0</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ua.aqua.proj</span> <span class="op">&lt;-</span> <span class="va">aquaculture.units</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">6367</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#fixed geometries </span></span>
<span><span class="co">#https://github.com/r-spatial/sf/issues/870</span></span>
<span><span class="va">ua.area.buff</span> <span class="op">&lt;-</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="va">ua.aqua.proj</span><span class="op">)</span>, <span class="va">inegi.cost.buffer.proj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">area.int</span> <span class="op">&lt;-</span> <span class="va">ua.area.buff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>area_loc_m2<span class="op">=</span><span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ext.area.proj.loc</span> <span class="op">&lt;-</span> <span class="va">ua.area.buff</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">area.int</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uarea.loc.sum</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">ext.area.proj.loc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>ua_area_loc_kmsq <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">area_loc_m2</span><span class="op">)</span><span class="op">/</span><span class="fl">1e+6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'CVE_MUN'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">uarea.loc.sum</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/sensitivity/aquaculture_units_buffer.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Adaptive capacity from 2020 census data</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.table</span> <span class="op">&lt;-</span> <span class="st">"inegi_coast_comm.csv"</span></span>
<span><span class="va">inegi.comms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_inegi.html">fix_inegi</a></span><span class="op">(</span><span class="va">inegi.table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): CVE_ENT, CVE_LOC, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): POBTOT, deci_lon, deci_lat</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inegi.comm.codes</span>  <span class="op">&lt;-</span>  <span class="va">inegi.comms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">CVE_LOC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inegi.data</span>  <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/"</span>,<span class="st">"inegi_coast_census.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7641</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">237</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span>   (6): CVE_LOC, CVE_ENT, CVE_MUN, NOM_ENT, NOM_MUN, NOM_LOC</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (231): ALTITUD, POBTOT, POBFEM, POBMAS, P_0A2, P_0A2_F, P_0A2_M, P_3YMAS...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost.data.pob</span> <span class="op">&lt;-</span> <span class="va">inegi.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Infrastructure</span></span>
<span></span>
<span><span class="co"># VPH_INTER Private dwelling with Internet</span></span>
<span><span class="co"># VPH_CEL Private dwelling with cell phone</span></span>
<span><span class="co"># VPH_TIC Private dwellings with information infrastructure: TOTHOG - VPH_SINTIC Private dwellings without information infrastructure</span></span>
<span><span class="co"># VPH_C_SERV Private dwellings with electricity, water tubing inside or outside the home, but within the property, as well as sewer</span></span>
<span><span class="co"># VPH_AEASP Private dwellings with water tubing and public water service</span></span>
<span></span>
<span><span class="va">infra.com.in</span> <span class="op">&lt;-</span> <span class="va">cost.data.pob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">VPH_INTER</span>, <span class="va">VPH_CEL</span>, <span class="va">VPH_SINTIC</span>, <span class="va">VPH_C_SERV</span>, <span class="va">VPH_AEASP</span>, <span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">VPH_INTER</span><span class="op">:</span><span class="va">TOTHOG</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVPH_INTER <span class="op">=</span> <span class="va">VPH_INTER</span><span class="op">/</span> <span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVPH_CEL <span class="op">=</span> <span class="va">VPH_CEL</span><span class="op">/</span> <span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVPH_TIC <span class="op">=</span> <span class="op">(</span><span class="va">TOTHOG</span> <span class="op">-</span> <span class="va">VPH_SINTIC</span><span class="op">)</span><span class="op">/</span><span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVPH_C_SERV <span class="op">=</span> <span class="va">VPH_C_SERV</span><span class="op">/</span> <span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVPH_AEASP <span class="op">=</span> <span class="va">VPH_AEASP</span><span class="op">/</span> <span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">VPH_INTER</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">PVPH_INTER</span><span class="op">:</span><span class="va">PVPH_AEASP</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Household characteristics </span></span>
<span><span class="co">#VIVTOT Inhabited, uninhabited, and temporary-use private homes. Includes homes without occupant information</span></span>
<span><span class="co"># TOTHOG Total census households, households in inhabited private homes. A household is considered in each private home. Includes single house on the land; apartment in building; housing in neighborhood; housing in a rooftop room; premises not built for habitation; mobile housing; shelter or class not specified</span></span>
<span><span class="co">#OCUPVIVPAR Occupants in inhabited private homes</span></span>
<span><span class="co">#PROM_OCUP Average number of occupants in inhabited private homes</span></span>
<span><span class="co">#PRO_OCUP_C Average number of occupants per room in inhabited private homes</span></span>
<span></span>
<span><span class="va">household.in</span> <span class="op">&lt;-</span> <span class="va">cost.data.pob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>, <span class="va">CVE_MUN</span>, <span class="va">POBTOT</span>, <span class="va">VIVTOT</span>, <span class="va">TOTHOG</span>, <span class="va">OCUPVIVPAR</span>, <span class="va">PROM_OCUP</span>, <span class="va">PRO_OCUP_C</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">POBTOT</span><span class="op">:</span><span class="va">PRO_OCUP_C</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PVIVTOT <span class="op">=</span> <span class="va">VIVTOT</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PTOTHOG <span class="op">=</span> <span class="va">TOTHOG</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>POCUPVIVPAR <span class="op">=</span> <span class="va">OCUPVIVPAR</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">PVIVTOT</span>, <span class="va">PTOTHOG</span>, <span class="va">POCUPVIVPAR</span>, <span class="va">PROM_OCUP</span>, <span class="va">PRO_OCUP_C</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Employment</span></span>
<span><span class="co"># PEA Economically active population Population aged 12 years and older economically active</span></span>
<span><span class="co"># POCUPADA Employed population Population aged 12 years and older employed</span></span>
<span><span class="co"># GRAPROES Average level of education</span></span>
<span><span class="co"># PDER_SS Population with health services Population affiliated with health services</span></span>
<span><span class="co"># P18A24A Population aged 18 - 24 that attends school</span></span>
<span><span class="co"># CPEA Change in the economically active population (2010-2020) Population aged 12 years and over economically active</span></span>
<span></span>
<span><span class="va">census.2010</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/datos_INEGI_2010/iter_00_cpv2010/conjunto_de_datos/iter_00_cpv2010.csv"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">census.2010.data</span> <span class="op">&lt;-</span> <span class="va">census.2010</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">longitud</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>CVE_ENT<span class="op">=</span><span class="va">entidad</span>, CVE_MUN <span class="op">=</span> <span class="va">mun</span>, CVE_LOC <span class="op">=</span> <span class="va">loc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/extract_comms.html">extract_comms</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">keep_when</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pobmas</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/make_code.html">make_code</a></span><span class="op">(</span><span class="op">)</span>  </span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">93</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): mun_cve, mun_nam, ent_cve, ent_nam</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: There were 187 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `across(where(~any(stringr::str_detect(., "^\\d+$"))),</span></span>
<span><span class="co">##   as.numeric)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> NAs introduced by coercion</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 186 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">census.2010.emp</span> <span class="op">&lt;-</span> <span class="va">census.2010.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">select</span><span class="op">(</span><span class="va">CVE_ENT</span><span class="op">:</span><span class="va">nom_loc</span>, <span class="va">pobtot</span>, <span class="va">pobmas</span>, <span class="va">pobfem</span>, <span class="va">pea</span>, <span class="va">p_12ymas</span>, <span class="va">p12ym_solt</span>, <span class="va">hogjef_f</span>, <span class="va">psin_relig</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">select</span><span class="op">(</span><span class="va">CVE_LOC</span>,<span class="va">pobtot</span><span class="op">:</span><span class="va">psin_relig</span><span class="op">)</span></span>
<span></span>
<span><span class="va">employ.in</span> <span class="op">&lt;-</span> <span class="va">cost.data.pob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">census.2010.emp</span>, by <span class="op">=</span> <span class="st">"CVE_LOC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">POBTOT</span>, <span class="va">PEA</span>, <span class="va">POCUPADA</span>, <span class="va">GRAPROES</span>, <span class="va">PDER_SS</span>, <span class="va">P_12YMAS</span>, <span class="va">P18A24A</span>, <span class="va">pea</span>, <span class="va">p_12ymas</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">PEA</span><span class="op">:</span><span class="va">P_12YMAS</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PPEA <span class="op">=</span> <span class="va">PEA</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PPOCUPADA <span class="op">=</span> <span class="va">POCUPADA</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PPDER_SS <span class="op">=</span> <span class="va">PDER_SS</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PP18A24A <span class="op">=</span> <span class="va">P18A24A</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CPEA <span class="op">=</span> <span class="op">(</span><span class="va">PEA</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">pea</span><span class="op">/</span><span class="va">p_12ymas</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">PPEA</span>, <span class="va">PPOCUPADA</span>, <span class="va">GRAPROES</span>, <span class="va">PPDER_SS</span>, <span class="va">P18A24A</span>, <span class="va">CPEA</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Population change </span></span>
<span><span class="co"># PRESOE15 Population residing in another state Population aged 5 years and older residing in another state in March 2015       </span></span>
<span><span class="co"># P12YM_SOLT Change in single population</span></span>
<span><span class="co"># HOGJEF_F Change in female households Households in inhabited private homes where the reference person is a woman  </span></span>
<span><span class="co"># PSIN_RELIG Population without religion or without religious affiliation People who declared that they had no religion or were not affiliated with one.</span></span>
<span><span class="co"># P12YM_SEPA Population that was married and separated</span></span>
<span></span>
<span><span class="va">census.2010.popch</span> <span class="op">&lt;-</span> <span class="va">census.2010.data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span> <span class="fu">select</span><span class="op">(</span><span class="va">CVE_ENT</span><span class="op">:</span><span class="va">CVE_MUN</span>, <span class="va">pobtot</span>, <span class="va">pobmas</span>, <span class="va">pobfem</span>, <span class="va">pea</span>, <span class="va">presoe05</span>, <span class="va">p_5ymas</span>, <span class="va">p_12ymas</span>, <span class="va">p12ym_solt</span>, <span class="va">hogjef_f</span>, <span class="va">psin_relig</span>, <span class="va">p12ym_sepa</span>, <span class="va">graproes</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">dis.personal.in</span> <span class="op">&lt;-</span> <span class="va">cost.data.pob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">POBTOT</span>, <span class="va">P_5YMAS</span>, <span class="va">PRESOE15</span>, <span class="va">P12YM_SOLT</span>, <span class="va">P_12YMAS</span>, <span class="va">HOGJEF_F</span>, <span class="va">PSIN_RELIG</span>, <span class="va">P12YM_SEPA</span>, <span class="va">GRAPROES</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">POBTOT</span><span class="op">:</span><span class="va">PSIN_RELIG</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">census.2010.popch</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_LOC"</span>,<span class="st">"CVE_MUN"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CPRESOE15 <span class="op">=</span> <span class="op">(</span><span class="va">PRESOE15</span><span class="op">/</span><span class="va">P_5YMAS</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">presoe05</span><span class="op">/</span><span class="va">p_5ymas</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CP12YM_SOLT <span class="op">=</span> <span class="op">(</span><span class="va">P12YM_SOLT</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">p12ym_solt</span><span class="op">/</span><span class="va">p_12ymas</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CHOGJEF_F <span class="op">=</span> <span class="op">(</span><span class="va">HOGJEF_F</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">hogjef_f</span><span class="op">/</span><span class="va">pobtot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CPSIN_RELIG <span class="op">=</span> <span class="op">(</span><span class="va">PSIN_RELIG</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">psin_relig</span><span class="op">/</span><span class="va">pobtot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CP12YM_SEPA <span class="op">=</span> <span class="op">(</span><span class="va">P12YM_SEPA</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">p12ym_sepa</span><span class="op">/</span><span class="va">p_12ymas</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>CGRAPROES <span class="op">=</span> <span class="va">GRAPROES</span> <span class="op">-</span> <span class="va">graproes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">CPRESOE15</span>, <span class="va">CP12YM_SOLT</span>, <span class="va">CHOGJEF_F</span>, <span class="va">CPSIN_RELIG</span>, <span class="va">CP12YM_SEPA</span>, <span class="va">CGRAPROES</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span> </span>
<span><span class="co">#Community characteristics</span></span>
<span><span class="co">#HOGJEF_F Households in inhabited private homes where the reference person is a woman</span></span>
<span><span class="co">#PCON_DISC People who have great difficulty performing or carrying out tasks in daily life</span></span>
<span><span class="co">#PROM_HNV Average number of daughters and sons born alive</span></span>
<span><span class="co">#GRAPROES_F Average level of education of the female population</span></span>
<span><span class="co">#P_15YMAS Population aged 15 years and over</span></span>
<span><span class="co">#P12YM_SEPA Population that was married and separated</span></span>
<span><span class="co">#P6A11_NOA Population from 6 to 11 years old that does not attend school</span></span>
<span></span>
<span><span class="va">comm.char.in</span> <span class="op">&lt;-</span> <span class="va">cost.data.pob</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">census.2010.emp</span>, by <span class="op">=</span> <span class="st">"CVE_LOC"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">POBTOT</span>, <span class="va">TOTHOG</span>, <span class="va">HOGJEF_F</span>, <span class="va">P_6A11</span>, <span class="va">P_12YMAS</span>, <span class="va">P12YM_SEPA</span>, <span class="va">P_15YMAS</span>, <span class="va">PCON_DISC</span>, <span class="va">P_60YMAS</span>, <span class="va">GRAPROES_F</span>, <span class="va">PROM_HNV</span>, <span class="va">P6A11_NOA</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="va">TOTHOG</span><span class="op">:</span><span class="va">P6A11_NOA</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PHOGJEF_F <span class="op">=</span> <span class="va">HOGJEF_F</span><span class="op">/</span><span class="va">TOTHOG</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PPCON_DISC <span class="op">=</span> <span class="va">PCON_DISC</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PP_60YMAS <span class="op">=</span> <span class="va">P_60YMAS</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PP_15YMAS <span class="op">=</span> <span class="va">P_15YMAS</span><span class="op">/</span><span class="va">POBTOT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PP12YM_SEPA <span class="op">=</span> <span class="va">P12YM_SEPA</span><span class="op">/</span><span class="va">P_12YMAS</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>PP6A11_NOA <span class="op">=</span> <span class="va">P6A11_NOA</span><span class="op">/</span><span class="va">P_6A11</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">CVE_MUN</span>, <span class="va">CVE_LOC</span>, <span class="va">PHOGJEF_F</span>, <span class="va">PPCON_DISC</span>, <span class="va">PROM_HNV</span>, <span class="va">GRAPROES_F</span>, <span class="va">PP_60YMAS</span>, <span class="va">PP_15YMAS</span>, <span class="va">PP12YM_SEPA</span>, <span class="va">PP6A11_NOA</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adap.census</span> <span class="op">&lt;-</span> <span class="va">comm.char.in</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dis.personal.in</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_MUN"</span>,<span class="st">"CVE_LOC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">employ.in</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_MUN"</span>,<span class="st">"CVE_LOC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">household.in</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_MUN"</span>,<span class="st">"CVE_LOC"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">infra.com.in</span>, by <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CVE_MUN"</span>,<span class="st">"CVE_LOC"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">adap.census</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data/adaptive_capacity/"</span>,<span class="st">"census_adaptive_capacity.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>WorldClim terrestrial historical and future data</p>
<p>BioOracle future marine data</p>
<p>Exposure data</p>
<p>Copy processed data to input directory</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">input.dir</span>,<span class="st">"/processed_data"</span><span class="op">)</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data-raw"</span><span class="op">)</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#file.copy(paste0(input.dir, "/processed_data/exposure"), here::here("data-raw/processed_data"), recursive=TRUE)</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
