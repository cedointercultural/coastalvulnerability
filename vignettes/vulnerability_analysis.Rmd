---
title: "Coastal vulnerability"

output:
  html_document

knit: (function(input, encoding) {
    rmarkdown::render(
      input = input,
      encoding = encoding,
      envir = globalenv()
    )
  })
---


```{r setup}
library(coastalvulnerability)
```

Identify coastal communities

```{r}

#specify CRS
#https://epsg.io/4485
crs.proj.utm <- "+proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +datum=NAD83"
crs.proj.wgs <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

input.dir <- "~/coastalvulnerability_inputs"

atlantic.shp <- sf::st_read(paste0(input.dir,"/inputs/shp_files/atlantic_ocean.shp"))
pacific.shp <- sf::st_read(paste0(input.dir,"/inputs/shp_files/pacific_ocean.shp"))

est.2019 <- sf::st_read(paste0(input.dir,"/inputs/datos_INEGI_2020/dest2019gw.shp"))
estados.shp <- sf::st_read(paste0(input.dir,"/inputs/shp_files/ESTADOS.shp"))

#estados.mx <- cbind(est.2019, st_coordinates(st_centroid(est.2019)))

#Datos censo 2020
inegi.2020 <- readr::read_csv(paste0(input.dir,"/inputs/datos_INEGI_2020/conjunto_de_datos/conjunto_de_datos_iter_00_cpv2020.csv"))

inegi.cost.wgs <- coastalvulnerability::get_community_data(crs.proj.utm,crs.proj.wgs, atlantic.shp, pacific.shp, est.2019, inegi.2020)

#Gulf of California and Yucatan Peninsula
ents.selecc <- c("Baja California Sur", "Baja California", "Sonora", "Sinaloa", "Nayarit", "Jalisco", "Yucatán", "Campeche", "Tabasco", "Quintana Roo")

coastalvulnerability::make_map(estados.shp, inegi.cost.wgs, thistitle="Total population",thisoutput="/outputs/figures/map_locs_en.png", ents.selecc)

coastalvulnerability::make_map(estados.shp, inegi.cost.wgs, thistitle="Población total ",thisoutput="/outputs/figures/map_locs_sp.png", ents.selecc)

ents.selecc <- c("Baja California Sur", "Baja California", "Sonora", "Sinaloa", "Nayarit", "Jalisco", "Colima", "Michoacán de Ocampo", "Guerrero", "Oaxaca", "Chiapas", "Quintana Roo", "Yucatán", "Campeche", "Tabasco", "Veracruz de Ignacio de la Llave", "Tamaulipas")

coastalvulnerability::make_map(estados.shp, inegi.cost.wgs, thistitle="Total population",thisoutput="/outputs/figures/map_locs_en_all.png", ents.selecc)

coastalvulnerability::make_map(estados.shp, inegi.cost.wgs, thistitle="Población total ",thisoutput="/outputs/figures/map_locs_sp_all.png", ents.selecc)


```

Descarga masiva de datos DENUE, Unidades economicas para todo el pais por tipo de actividad economica
Datos actualizados a Noviembre 2022
```{r}

actividad.denue <- lapply(denue.inegi, get_denue) %>% 
  bind_rows

fwrite(actividad.denue,here("inputs","sensitivity","denue","actividades_denue.csv"))


```



```{r}
sheetlink = "https://docs.google.com/spreadsheets/d/1j9GJKPjKgpf4w3bDeS2c8uamN8-L79I1BINjpQe0lCk/edit#gid=1817952998"
# 
tabla.susc <- read_googlesheet(sheetlink, sheetname = "resumen_indicadores_susceptibilidad", coltypes = "cccccccccccccccccccc")
tabla.susc <- read_googlesheet(sheetlink, sheetname = "resumen_indicadores_exposicion", coltypes = "cccccccccccccccccccc")


for(i in 1:nrow(tabla.susc)){
  
  this.susc <- tabla.susc[i,]
  
}

```

```{r}
https://googledrive.tidyverse.org/reference/drive_download.html
drive_download("index-chicken-sheet")

google_client <- gargle::gargle_oauth_client_from_json(
  path = "/home/atlantis/client_secret_616841014505-td5h9bbgbs17rk4l7o76e52gnaciddkb.apps.googleusercontent.com.json",
  name = "Desktop client 1"
)
drive_auth_configure(app = google_client)
client_secret_616841014505-td5h9bbgbs17rk4l7o76e52gnaciddkb.apps.googleusercontent.com.json

save.path <- "/nfsdata/coastalvulnerabilityinputs/coastalvulnerability_inputs/inputs/sensitivity"

googledrive::drive_download(file="https://docs.google.com/spreadsheets/d/17VUvs9pFnICMn7O4xmAJQEEk6hoyOvjY/edit?usp=drive_link&ouid=102018831457411307080&rtpof=true&sd=true", path=paste0(save.path,"/Beneficiarios_Desarrollo_Estrategico_Acuacultura.xlsx"), overwrite=TRUE)

```

