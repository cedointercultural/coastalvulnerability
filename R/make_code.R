#' Add code based on locality, municipality and state codes
#'
#' @param this.tibble
#'
#' @return code.tibble
#' @export
#'
#' @examples
make_code <- function(this.tibble){

  if("LOC" %in% names(this.tibble) & "ENTIDAD" %in% names(this.tibble)){

    code.tibble <- this.tibble %>%
      dplyr::mutate(no_loc = nchar(LOC), no_mun = nchar(MUN), no_ent = nchar(ENTIDAD)) %>%
      dplyr::mutate(cve_loc = as.character(LOC), cve_mun = as.character(MUN), cve_ent = as.character(ENTIDAD)) %>%
      dplyr::mutate(cveloc=dplyr::if_else(no_loc==1,paste0("000",cve_loc),
                                          dplyr::if_else(no_loc==2,paste0("00",cve_loc),
                                                         dplyr::if_else(no_loc==3,paste0("0",cve_loc),
                                                                        dplyr::if_else(no_loc==4,cve_loc, cve_loc))))) %>%
      dplyr::mutate(cvemun=dplyr::if_else(no_mun==1,paste0("00",cve_mun),
                                          dplyr::if_else(no_mun==2,paste0("0",cve_mun), cve_mun))) %>%
      dplyr::mutate(cveent=dplyr::if_else(no_ent==1,paste0("0",cve_ent), cve_ent)) %>%
      dplyr::mutate(CVE_LOC = paste0(cveent,cvemun,cveloc), id_row = 1) %>%
      dplyr::mutate(CVE_MUN = paste0(cveent,cvemun)) %>%
      dplyr::select(id_row, CVE_LOC, CVE_MUN, everything())
  }

  if("CVE_ENT" %in% names(this.tibble)){

    code.tibble <- this.tibble %>%
      dplyr::mutate(no_loc = nchar(CVE_LOC), no_mun = nchar(CVE_MUN), no_ent = nchar(CVE_ENT)) %>%
      dplyr::mutate(cve_loc = as.character(CVE_LOC), cve_mun = as.character(CVE_MUN), cve_ent = as.character(CVE_ENT)) %>%
      dplyr::mutate(cveloc=dplyr::if_else(no_loc==8,paste0("0",cve_loc), cve_loc)) %>%
      dplyr::mutate(cvemun=dplyr::if_else(no_mun==1,paste0("00",cve_mun),
                                          dplyr::if_else(no_mun==2,paste0("0",cve_mun), cve_mun))) %>%
      dplyr::mutate(cveent=dplyr::if_else(no_ent==1,paste0("0",cve_ent), cve_ent)) %>%
      dplyr::mutate(CVE_LOC = paste0(cveloc)) %>%
      dplyr::mutate(CVE_MUN = paste0(cveent,cvemun)) %>%
      dplyr::select(CVE_LOC, CVE_MUN, everything())
  }

  if("ENTIDAD" %in% names(this.tibble) & "CVE_LOC" %in% names(this.tibble)){

    code.tibble <- this.tibble %>%
      dplyr::mutate(no_loc = nchar(CVE_LOC), no_mun = nchar(CVE_MUN), no_ent = nchar(ENTIDAD)) %>%
      dplyr::mutate(cve_loc = as.character(CVE_LOC), cve_mun = as.character(CVE_MUN), cve_ent = as.character(ENTIDAD)) %>%
      dplyr::mutate(cveloc=dplyr::if_else(no_loc==8,paste0("0",cve_loc), cve_loc)) %>%
      dplyr::mutate(cvemun=dplyr::if_else(no_mun==1,paste0("00",cve_mun),
                                          dplyr::if_else(no_mun==2,paste0("0",cve_mun), cve_mun))) %>%
      dplyr::mutate(cveent=dplyr::if_else(no_ent==1,paste0("0",cve_ent), cve_ent)) %>%
      dplyr::mutate(CVE_LOC = paste0(cveloc)) %>%
      dplyr::mutate(CVE_MUN = paste0(cveent,cvemun)) %>%
      dplyr::select(CVE_LOC, CVE_MUN, everything())
  }

  if("cve_loc" %in% names(this.tibble)){

    code.tibble <- this.tibble %>%
    dplyr::mutate(no_loc = nchar(cve_loc), no_mun = nchar(cve_mun), no_ent = nchar(cve_ent)) %>%
    dplyr::mutate(cve_loc = as.character(cve_loc), cve_mun = as.character(cve_mun), cve_ent = as.character(cve_ent)) %>%
    dplyr::mutate(cveloc=dplyr::if_else(no_loc==1,paste0("000",cve_loc),
                                 dplyr::if_else(no_loc==2,paste0("00",cve_loc),
                                                dplyr::if_else(no_loc==3,paste0("0",cve_loc),
                                                               dplyr::if_else(no_loc==4,cve_loc, cve_loc))))) %>%
    dplyr::mutate(cvemun=dplyr::if_else(no_mun==1,paste0("00",cve_mun),
                                        dplyr::if_else(no_mun==2,paste0("0",cve_mun), cve_mun))) %>%
    dplyr::mutate(cveent=dplyr::if_else(no_ent==1,paste0("0",cve_ent), cve_ent)) %>%
    dplyr::mutate(CVE_LOC = paste0(cveent,cvemun,cveloc), id_row = 1) %>%
    dplyr::mutate(CVE_MUN = paste0(cveent,cvemun)) %>%
    dplyr::select(id_row, CVE_LOC, CVE_MUN, tidyselect::everything())
}

   if("ENT" %in% names(this.tibble) & "CVE_LOC" %in% names(this.tibble)){

    code.tibble <- this.tibble %>%
       dplyr::mutate(CVE_MUN = paste0(ENT, MUN)) %>%
      dplyr::select(CVE_LOC, CVE_MUN, tidyselect::everything())


  }

  return(code.tibble)
}
