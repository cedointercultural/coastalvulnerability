get_directionality <- function(this.data, indicator.index, indicator.name){


  ind.vars.direcc <- indicator.index %>%
    select(variable_id, direction, indicator_category) %>%
    dplyr::rename(indicator=variable_id)

  max.col <- ncol(this.data)

  this.data.long <- this.data %>%
    replace(is.na(.), 0) %>%
    tidyr::pivot_longer(cols=3:max.col, names_to="indicator", values_to="value") %>%
    dplyr::left_join(ind.vars.direcc, by = "indicator")

    #test for indicators with missing directionality

  all.ind <- this.data.long %>%
    dplyr::distinct(indicator, direction, indicator_category)

  print(all.ind)

  missing.ind <- this.data.long %>%
    keep_when(is.na(direction)) %>%
    dplyr::distinct(indicator)

  print(missing.ind)

  this.data.long.nosing <- this.data.long %>%
    keep_when(!is.na(direction)) %>% # remove tot_score
    mutate(component = indicator.name)

  return(this.data.long.nosing)

}
