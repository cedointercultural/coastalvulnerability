
#' Get total component score
#'
#' @param this.ent.data data scaled by state
#' @param this.mun.data data scaled by municipality
#' @param indicator.name component name
#'
#' @return ind.tot.data
#' @export
#'
#' @examples
get_comp_score <- function(this.ent.data, this.mun.data, indicator.name){

  comp.data <- dplyr::bind_rows(this.ent.data, this.mun.data)

  index.comp.data <- comp.data %>%
    select(CVE_MUN, CVE_LOC)

  ind.comp.data <- comp.data %>%
    select(-CVE_MUN, -CVE_LOC, -(CVE_ENT:deci_lat))

  tot.ind <- ncol(ind.comp.data)

  ind.tot.data <- ind.comp.data %>%
    mutate(tot_score = rowMeans(dplyr::across(1:tot.ind), na.rm=TRUE)) %>%
    mutate(tot_score_sc= scales::rescale(tot_score, to = c(0, 1))) %>%
    mutate(component = indicator.name) %>%
    dplyr::bind_cols(index.comp.data) %>%
    select(CVE_MUN, CVE_LOC, component, dplyr::everything())

  readr::write_csv(ind.tot.data, here::here("outputs","analysis",paste0("comp_score_", indicator.name,".csv")))
  return(ind.tot.data)

  #ind.tot.data <- ind.comp.data %>%
  #mutate("tot_{indicator.name}" := rowMeans(dplyr::across(1:ncol(.)), na.rm=TRUE)) %>%
  #dplyr::mutate("tot_{indicator.name}":= scales::rescale("tot_{indicator.name}", to = c(0, 1)))

}
