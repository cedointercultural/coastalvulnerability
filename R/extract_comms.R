#' Extract target states and municipalities
#'
#' @param this.data
#' @param inegi.cost.comm
#'
#' @return this.data.selec
#' @export
#'
#' @examples
extract_comms <- function(this.data){

  mun.ent.codes <- readr::read_csv(paste0(input.dir,"/processed_data/","mun_ent_codes.csv"))

  ent.cost <- mun.ent.codes %>%
    dplyr::mutate(entidad=toupper(ent_nam)) %>%
    dplyr::mutate(entidad = stringi::stri_trans_general(str = entidad, id = "Latin-ASCII")) %>%
    dplyr::distinct(entidad) %>%
    dplyr::pull(entidad)

  mun.cost <- mun.ent.codes %>%
    dplyr::mutate(municipio=toupper(mun_nam)) %>%
    dplyr::mutate(municipio = stringi::stri_trans_general(str = municipio, id = "Latin-ASCII")) %>%
    dplyr::distinct(municipio) %>%
    dplyr::pull(municipio)

  if("entidad" %in% names(this.data)){

    this.data.selec <- this.data %>%
      dplyr::filter(entidad %in% ent.cost) %>%
      dplyr::filter(municipio %in% mun.cost)
  }

  if("ENTIDAD" %in% names(this.data)){

    this.data.selec <- this.data %>%
      dplyr::filter(ENTIDAD %in% ent.cost) %>%
      dplyr::filter(MUNICIPIO %in% mun.cost) %>%
      dplyr::mutate(no_loc = nchar(CVE_LOC), CVE_LOC = as.character(CVE_LOC)) %>%
      dplyr::mutate(CVE_LOC = dplyr::if_else(no_loc==8,paste0("0",CVE_LOC),CVE_LOC))


  }

  if("NOMBRE ESTADO" %in% names(this.data)){

    this.data.selec <- this.data %>%
      dplyr::filter(`NOMBRE ESTADO` %in% ent.cost) %>%
      dplyr::filter(`NOMBRE MUNICIPIO` %in% mun.cost) %>%
      dplyr::mutate(CVE_LOC = as.character(`CLAVE LOCALIDAD`), no_loc = nchar(CVE_LOC)) %>%
      dplyr::mutate(CVE_LOC = dplyr::if_else(no_loc==8,paste0("0",CVE_LOC),CVE_LOC))


  }
  return(this.data.selec)
}
