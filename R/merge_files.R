#' Merge indicator files
#'
#' @param indicator.list
#' @param cost.data.pob
#'
#' @return
#' @export
#'
#' @examples
merge_files <- function(indicator.list, cost.data.pob){

  this.data <- readr::read_csv(indicator.list[1])

  cost.data.pob.ind <- cost.data.pob %>%
    dplyr::left_join(this.data, by = c("CVE_LOC","CVE_MUN"))

  for(eachfile in 2:length(indicator.list)){

    print(eachfile)
    this.new.data <- readr::read_csv(indicator.list[eachfile])
    print(indicator.list[eachfile])

    if("POBTOT" %in% colnames(this.new.data)){

      cost.data.pob.ind <- cost.data.pob.ind %>%
        dplyr::left_join(this.new.data, by = c("CVE_LOC","CVE_MUN","POBTOT"))


    } else {

      cost.data.pob.ind <- cost.data.pob.ind %>%
        dplyr::left_join(this.new.data, by = c("CVE_LOC","CVE_MUN"))

        }

      }

  cost.data.indi <- cost.data.pob.ind %>%
    dplyr::select(!(CVE_ENT:deci_lat))

  cost.data.vals <- cost.data.pob.ind %>%
    replace(is.na(.), 0) %>%
    mutate(sum = rowSums(dplyr::across(ua_area_loc_kmsq:catch_percapita), na.rm=TRUE)) %>%
    keep_when(sum>0) %>%
    select(-sum)

  cost.data.id <- cost.data.vals %>%
  dplyr::select(CVE_ENT:deci_lat)


    list.cols <- list()

    for(eachcol in 1:ncol(cost.data.indi)){

      print(eachcol)
      this.col <- cost.data.indi %>%
        select(eachcol)

      process.num <- caret::preProcess(this.col, method=c("range"))

      scaled.this.col <- stats::predict(process.num, this.col)

      list.cols[[eachcol]] <- scaled.this.col

    }

    scaled.cols <- list.cols %>%
      dplyr::bind_cols()

    ind.pob.sc <- dplyr::bind_cols(cost.data.id, scaled.cols)

  return(cost.data.pob.ind)
}
