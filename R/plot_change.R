#' Plot component scores
#'
#' @param this.data
#' @param cost.data.comms
#' @param scenario.name
#' @param cols
#' @param ent.ord
#' @param title.txt
#'
#' @return
#' @export
#'
#' @examples plot_change(this.data.hist=tot.scores.comp.hist, this.data.ssp126=tot.scores.comp.ssp126, this.data.ssp585=tot.scores.comp.ssp585, ent.cols, ent.ord, title.txt="Cambio en exposición relativo a condiciones actuales")
plot_change <- function(this.data.hist, this.data.ssp126, this.data.ssp585, ent.cols, ent.ord, title.txt){

  this.data.hist.tot <- this.data.hist %>%
    dplyr::rename(tot_score_hist_sc =tot_score_sc, tot_score_hist =tot_score) %>%
    keep_when(grepl("exposure",component)) %>%
    select(CVE_LOC, tot_score_hist, tot_score_hist_sc)

  this.data.exp.585 <- this.data.ssp585 %>%
    keep_when(grepl("exposure",component)) %>%
    dplyr::left_join(this.data.hist.tot, by=c("CVE_LOC"))

  this.data.sc.tot <- this.data.ssp126 %>%
    keep_when(grepl("exposure",component)) %>%
    dplyr::left_join(this.data.hist.tot, by=c("CVE_LOC")) %>%
    dplyr::bind_rows(this.data.exp.585) %>%
    mutate(NOM_ENT_fac=factor(NOM_ENT, levels=ent.ord)) %>%
    mutate(change_score =((tot_score_sc*100)/tot_score_hist_sc)-100) %>%
    mutate(component = gsub("exposure_","",component))

    pointplot.vulne <- this.data.sc.tot %>%
    ggplot2::ggplot(ggplot2::aes(y= change_score, x=component, color=NOM_ENT_fac))+
    ggplot2::geom_violin(position = ggplot2::position_dodge(width = 0.9), alpha = 0.85) +
    ggplot2::geom_point(position = ggplot2::position_jitterdodge(seed = 1, dodge.width = 0.9), size = 1, alpha = 0.6)+
    ggplot2::scale_color_manual(values= ent.cols) +
 #   ggplot2::theme_light() +
    ggplot2::labs(x = "Escenario futuro",
                  y="% Cambio en exposición",
                  title = paste(title.txt),
                  color = "Entidad")
  #  ggplot2::annotate("text",x = 0.3, y = 0.9, label = "Alta \n vulnerabilidad", color = "gray35",size = 2.2) +
  #  ggplot2::annotate("text",x = 0.7, y = 0.1, label = "Baja \n vulnerabilidad", color = "gray35",size = 2.2) +
  #  ggplot2::scale_x_reverse()

  ggplot2::ggsave(here::here("outputs","figures","change_expo_state.png"), pointplot.vulne, device="png", width = 10, height = 8)

  return(pointplot.vulne)

}
